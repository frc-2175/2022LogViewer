<script
type="text/javascript"
src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"
></script>
<link href="../../dist/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />

<div id="tooltips"></div>

<script>
const rawData = `{"message":"Spacetime Start","fields":[{"tags":[],"value":"Competition","name":"Robot"},{"tags":[],"value":2175,"name":"Team"},{"tags":[],"value":"Robot on!!!","name":"EventName"},{"tags":[],"value":1,"name":"ID"},{"tags":[],"value":-1,"name":"ParentID"}],"level":"INFO","timestamp":0}
{"message":"Spacetime Start","fields":[{"tags":[],"value":"Competition","name":"Robot"},{"tags":[],"value":2175,"name":"Team"},{"tags":[],"value":"Robot enabled!!!","name":"EventName"},{"tags":[],"value":2,"name":"ID"},{"tags":[],"value":1,"name":"ParentID"}],"level":"INFO","timestamp":1}
{"message":"Spacetime Start","fields":[{"tags":[],"value":"Competition","name":"Robot"},{"tags":[],"value":2175,"name":"Team"},{"tags":[],"value":"Motor Data","name":"EventName"},{"tags":[],"value":3,"name":"ID"},{"tags":[],"value":-1,"name":"ParentID"}],"level":"INFO","timestamp":3}
{"message":"Spacetime End","fields":[{"tags":[],"value":"Competition","name":"Robot"},{"tags":[],"value":2175,"name":"Team"},{"tags":[],"value":"Robot on!!!","name":"EventName"},{"tags":[],"value":1,"name":"ID"},{"tags":[],"value":-1,"name":"ParentID"}],"level":"INFO","timestamp":4}
{"message":"Spacetime End","fields":[{"tags":[],"value":"Competition","name":"Robot"},{"tags":[],"value":2175,"name":"Team"},{"tags":[],"value":"Robot enabled!!!","name":"EventName"},{"tags":[],"value":2,"name":"ID"},{"tags":[],"value":1,"name":"ParentID"}],"level":"INFO","timestamp":2}
{"message":"Spacetime End","fields":[{"tags":[],"value":"Competition","name":"Robot"},{"tags":[],"value":2175,"name":"Team"},{"tags":[],"value":"Motor Data","name":"EventName"},{"tags":[],"value":3,"name":"ID"},{"tags":[],"value":-1,"name":"ParentID"}],"level":"INFO","timestamp":4}`;

function generateTimelineDataFromLog() {
const jsonData = {data: []}
  const startStopData = {}
  let spacetimeIDlist = []
  let timelineData = []
  let eventID;
  let eventName;

  rawData.split("\n").forEach((item) => {
      jsonData["data"].push(JSON.parse(item))
  })
  jsonData["data"].forEach((eventItem) => {
      if (eventItem["message"] == "Spacetime Start" || eventItem["message"] == "Spacetime End") {
          console.log(eventItem["message"])
          eventItem["fields"].forEach((item) => {
              if (item["name"] == "ID") {
                  eventID = item["value"]
                  if (startStopData[item["value"]] == undefined) {
                      startStopData[item["value"]] = {}
                  }
                  if (eventItem["message"] == "Spacetime Start") {
                      startStopData[item["value"]]["start"] = eventItem["timestamp"]
                  } else {
                      startStopData[item["value"]]["end"] = eventItem["timestamp"]
                }
              }
              if(item["name"] == "EventName") {
                  eventName = item["value"]
              }
          })
          if (spacetimeIDlist[eventID - 1] == undefined) {
              timelineData.push({id: eventID, content: eventName})
              spacetimeIDlist.push(eventID)
          }
      }
  })

  timelineData.forEach((item, index) => {
      item["start"] = startStopData[index + 1]["start"]
      item["end"] = startStopData[index + 1]["end"]
  })
  return timelineData;
}

// Create a DataSet (allows two way data-binding)
var items = new vis.DataSet(generateTimelineDataFromLog(rawData));

// Options
var options = {};

// Timeline object

var timelineTooltips = new vis.Timeline(
    document.getElementById("tooltips"),
    items,
    options
);

// Follow options
var follow_options = {
  tooltip: {
    followMouse: true,
  },
};
</script>
    